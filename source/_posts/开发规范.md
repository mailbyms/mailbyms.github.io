---
title: 开发规范
date: 2021-02-22 16:51:07
categories:
  - 研发流程
tags:
  - 规范
  - java
  - vue
---

# 开发规范

## 开发工具

- Java 项目使用 `IntelliJ IDEA`
  - 建议安装插件 `SonarLint` 和 `Alibaba Java Coding Guidelines` ，在开发过程使用这2个插件检查代码
- 网站开发使用 `Visual Studio Code`
  - 



## 通用

- 配置文件

  - 不要在代码里 hard code `外部接口`地址等，要写到配置文件里
  - 不是本项目实现的、要调用别人的功能，都属于`外部接口`
  - 不允许＂换个环境部署＂或 ＂改个接口地址＂就要重新编译代码打包，用配置文件解决

  - 不允许针对不同环境使用不同的编译命令，例如正式和测试环境分别使用下面命令编译 `npm run build-pro`, `npm run build-dev`，这是不对的。应使用通用的编译命令，通过配置文件调整参数
  - 配置文件里每个变量，应只有一个赋值。
    - 赋值要简单、直接
    - 不允许在同一个配置文件里列出“测试”、"正式" 等多个环境对应的值，再经过第二层判断选定

- 事务

  - 例如购买行为，要按订单流程走：生成订单、支付扣款。记录流程对应的中间状态

  - 在 生成订单和支付扣款的处理中，分别要加上分布式锁

- 安全
  - 《Web应用安全开发规范-V1.5.docx》，注意最后章节的附件



 ## Java

### 常见的性能瓶颈

- DB数据库

  - Java 代码可以多实例多线程，可以水平扩展

  - DB 最优的情况下也会有行锁。DB 是传统的瓶颈项

  - 不要把 DB 当成逻辑处理单元，要尽量简单的增删改查逻辑

  - 能在 Java 代码处理的逻辑，不要让 DB 来处理
  - 思考  NoSQL 的来源，就是为了避免 SQL 的复杂
- 第三方调用
  - 不影响用户预期的，放到任务表，由其它项目操作
    - 使用新建线程，也会占用当前 JVM 资源，尽量丢给别的项目干活。即“微服务”的思想
  - 例如发送短信验证码接口
    - 接口只保存任务，即返回接口成功
    - 其它项目再调用接口API发送短信
- 消息队列
  - 关注消息队列发消息耗时
  - 例如南海云课堂上传视频到OSS
    - biz 保存任务到DB
    - 新项目（多个实例部署）去完成任务。
    - 传视频的任务耗时长，不适合放在接口主项目，占用资源，影响其它接口
- 接口准入
  - 公司内部的接口，给内部的网页/APP 接口时，也要使用鉴权，例如 APPID/SECRECT
  - 把接口提供给外面的公司使用时，为对方新建 APPID/SECRECT 。
- 功能切割
  - 把上传功能做成独立的项目并提供接口。服务器配置文件控制 文件保存到  FastDFS 或者 阿里云 OSS，或者 其它的品牌的对象存储（如华为云的对象存储）
  - 统一文件上传的逻辑。网页/客户端 通过上传接口获取到文件 URL，调用接口保存表单时在接口只传递 URL 参数。（参考 UEditor 的做法）
- 版权
  - 尽量使用 OpenJDK，不要使用 Oracle JDK 的独有功能。后者可能会带来版权问题。

## Web前端 

特别要注意前面 “通用“ 章节的说明

